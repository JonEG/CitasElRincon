{"ast":null,"code":"var _jsxFileName = \"/Users/trabajo/Desktop/ELRINCON/react-rincon/src/controllers/profileController.js\";\nimport React, { Component } from 'react';\nimport ProfessionalService from '../services/professional.service';\nimport DepartmentService from '../services/department.service';\nimport TutorService from '../services/tutor.service';\nimport RoleService from '../services/role.service';\nimport ImageService from '../services/image.service';\nimport ProfileController from '../controllers/profileController';\nimport Swal from 'sweetalert2';\nimport { data } from 'jquery';\n\nconst jsSHA3 = require('jssha/dist/sha3');\n\nclass profileController {\n  constructor() {\n    this.state = {\n      email: sessionStorage.getItem('userEmail'),\n      response: {},\n      departments: [],\n      roles: [],\n      tutors: [],\n      correctlyCreated: 'false'\n    };\n  }\n\n  async loadUserId() {\n    await ProfessionalService.getWithEmail({\n      email: sessionStorage.getItem('userEmail')\n    }).then(res => {\n      if (res.data.success) {\n        this.state.response = {\n          redirect: '/',\n          allowCreation: false\n        };\n      } else {\n        this.state.response = {\n          redirect: null,\n          allowCreation: true\n        };\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return this.state.response;\n  }\n\n  async queryProfessionals() {\n    let myState = {};\n    await ProfessionalService.getWithEmail({\n      email: this.state.email\n    }).then(async res => {\n      if (res.data.success) {\n        const {\n          id,\n          name,\n          departmentId,\n          roleId,\n          tutorId,\n          comment,\n          imageId\n        } = res.data.data[0];\n        myState = {\n          id: id,\n          name: name,\n          departmentId: departmentId,\n          roleId: roleId,\n          tutorId: tutorId,\n          comment: comment,\n          imageId: imageId\n        };\n\n        if (imageId != null) {\n          await ImageService.get(imageId).then(res => {\n            myState.image = this.cargarImagenDeBBDD(res.data.data[0]);\n          }).catch(err => {\n            console.error('ERROR server ' + err);\n          });\n        } else {\n          console.error('No hay imagen asociada a esta cuenta.');\n        }\n      } else {\n        console.error('Error quering professional EDIT');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return myState;\n  }\n\n  cargarImagenDeBBDD(imagenDeBBDD) {\n    let bufferOriginal = null;\n\n    if (imagenDeBBDD.type.includes('image')) {\n      // Pasar buffer a string\n      bufferOriginal = Buffer.from(imagenDeBBDD.data); // Pasar buffer a formato utf\n\n      imagenDeBBDD.data = bufferOriginal.toString('utf8');\n    } else {\n      Swal.fire({\n        position: 'top',\n        icon: 'error',\n        title: 'Sólo archivos de tipo imagen!',\n        showConfirmButton: false,\n        timer: 2000\n      });\n    }\n\n    return imagenDeBBDD;\n  }\n\n  async queryDepartments() {\n    await DepartmentService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.departments = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n  }\n\n  async queryRoles() {\n    await RoleService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.roles = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n  }\n\n  async queryTutors() {\n    await TutorService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.tutors = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return this.state.tutors;\n  }\n\n  async loadDepartments() {\n    await this.queryDepartments();\n    return this.state.departments.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 11\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 16\n          }\n        });\n      }\n    });\n  }\n\n  async loadRoles() {\n    await this.queryRoles();\n    return this.state.roles.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 11\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 16\n          }\n        });\n      }\n    });\n  }\n\n  async loadTutors() {\n    await this.queryTutors();\n    return this.state.tutors.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 11\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 16\n          }\n        });\n      }\n    });\n  }\n\n  validateFields(nombre, departamentoId, roleId) {\n    let emptyFields = '';\n    let count = 0;\n\n    if (nombre.replace(/\\s/g, '').length == 0) {\n      emptyFields += ' Nombre ';\n      count++;\n    }\n\n    if (departamentoId == null) {\n      emptyFields += ' Departamento ';\n      count++;\n    }\n\n    if (roleId == null) {\n      emptyFields += ' Rol ';\n      count++;\n    } // If there are errors\n\n\n    if (count > 0) {\n      Swal.fire({\n        position: 'center',\n        icon: 'error',\n        title: (count == 1 ? 'Falta el campo' : 'Faltan los campos: ') + emptyFields,\n        showConfirmButton: false,\n        timer: 2000\n      });\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  async addProfessional(datapost) {\n    const {\n      name,\n      departmentId,\n      roleId\n    } = datapost;\n\n    if (this.validateFields(name, departmentId, roleId) == false) {\n      return;\n    }\n\n    await ProfessionalService.create(datapost).then(async res => {\n      if (res.data.success) {\n        await Swal.fire({\n          position: 'top',\n          icon: 'success',\n          title: '¡Enhorabuena, ya tiene perfil!',\n          showConfirmButton: false,\n          timer: 2000\n        });\n        this.state.correctlyCreated = 'true';\n      } else {\n        console.error('Error creating professional');\n      }\n    }).catch(error => {\n      console.error('Error 34 ' + error);\n    });\n    return this.state.correctlyCreated;\n  }\n\n  updateProfessional(datapost) {\n    this.validateFields(datapost.name, datapost.departmentId, datapost.roleId);\n    ProfessionalService.update(datapost).then(res => {\n      if (res.data.success) {\n        Swal.fire({\n          position: 'top',\n          icon: 'success',\n          title: 'Profesional actualizado correctamente!',\n          showConfirmButton: false,\n          timer: 2000\n        });\n      } else {\n        console.error('Error');\n      }\n    }).catch(error => {\n      console.error('Error 34 ' + error);\n    });\n  }\n\n  async readURL(input) {\n    return new Promise(function (resolve, reject) {\n      const miImagen = {};\n\n      if (input.files && input.files[0]) {\n        const myValue = input.files[0];\n        const random = Math.floor(Math.random() * 100 + 1) === 69;\n\n        if (random) {\n          Swal.fire({\n            position: 'top',\n            icon: 'success',\n            title: 'Esa imagen es muy grande para mi puertito!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        } else if (myValue.size > 2000000) {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Demasiado grande!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n\n        if (myValue.type.includes('image')) {\n          const reader = new FileReader();\n          reader.readAsDataURL(myValue);\n\n          reader.onload = event => {\n            const shaObj = new jsSHA3('SHA3-512', 'TEXT', {\n              encoding: 'UTF8'\n            });\n            shaObj.update(event.target.result);\n            miImagen.id = shaObj.getHash('HEX');\n            miImagen.data = event.target.result;\n            miImagen.name = myValue.name;\n            miImagen.type = myValue.type;\n            resolve(miImagen);\n          };\n\n          reader.onerror = err => {\n            console.error('Error en lectura de imagen --> ' + err);\n            reject(null);\n          };\n        } else {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Sólo archivos de tipo imagen!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n      }\n    });\n  }\n\n  checkImageExistence(datapost) {\n    console.log(datapost);\n    const {\n      image\n    } = datapost;\n    ImageService.get(image.id).then(res => {\n      if (res.data.success) {\n        datapost.user.imageId = image.id;\n      }\n    });\n    return datapost;\n  }\n\n}\n\nexport default new profileController();","map":{"version":3,"sources":["/Users/trabajo/Desktop/ELRINCON/react-rincon/src/controllers/profileController.js"],"names":["React","Component","ProfessionalService","DepartmentService","TutorService","RoleService","ImageService","ProfileController","Swal","data","jsSHA3","require","profileController","constructor","state","email","sessionStorage","getItem","response","departments","roles","tutors","correctlyCreated","loadUserId","getWithEmail","then","res","success","redirect","allowCreation","catch","err","console","error","queryProfessionals","myState","id","name","departmentId","roleId","tutorId","comment","imageId","get","image","cargarImagenDeBBDD","imagenDeBBDD","bufferOriginal","type","includes","Buffer","from","toString","fire","position","icon","title","showConfirmButton","timer","queryDepartments","getAll","queryRoles","queryTutors","loadDepartments","map","loadRoles","loadTutors","validateFields","nombre","departamentoId","emptyFields","count","replace","length","addProfessional","datapost","create","updateProfessional","update","readURL","input","Promise","resolve","reject","miImagen","files","myValue","random","Math","floor","size","reader","FileReader","readAsDataURL","onload","event","shaObj","encoding","target","result","getHash","onerror","checkImageExistence","log","user"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ProfessionalService from '../services/professional.service';\nimport DepartmentService from '../services/department.service';\nimport TutorService from '../services/tutor.service';\nimport RoleService from '../services/role.service';\nimport ImageService from '../services/image.service';\nimport ProfileController from '../controllers/profileController';\n\nimport Swal from 'sweetalert2';\nimport { data } from 'jquery';\n\nconst jsSHA3 = require('jssha/dist/sha3');\n\nclass profileController {\n  constructor () {\n    this.state = {\n      email: sessionStorage.getItem('userEmail'),\n      response: {},\n      departments: [],\n      roles: [],\n      tutors: [],\n      correctlyCreated: 'false'\n    };\n  }\n\n  async loadUserId () {\n    await ProfessionalService.getWithEmail({ email: sessionStorage.getItem('userEmail') })\n      .then(res => {\n        if (res.data.success) {\n          this.state.response = { redirect: '/', allowCreation: false };\n        } else {\n          this.state.response = { redirect: null, allowCreation: true };\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n    return this.state.response;\n  }\n\n  async queryProfessionals () {\n    let myState = {};\n    await ProfessionalService.getWithEmail({ email: this.state.email })\n      .then(async res => {\n        if (res.data.success) {\n          const { id, name, departmentId, roleId, tutorId, comment, imageId } = res.data.data[0];\n\n          myState = {\n            id: id,\n            name: name,\n            departmentId: departmentId,\n            roleId: roleId,\n            tutorId: tutorId,\n            comment: comment,\n            imageId: imageId\n          };\n\n          if (imageId != null) {\n            await ImageService.get(imageId).then(res => {\n              myState.image = this.cargarImagenDeBBDD(res.data.data[0]);\n            }).catch(err => {\n              console.error('ERROR server ' + err);\n            });\n          } else {\n            console.error('No hay imagen asociada a esta cuenta.');\n          }\n        } else {\n          console.error('Error quering professional EDIT');\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n    return myState;\n  }\n\n  cargarImagenDeBBDD (imagenDeBBDD) {\n    let bufferOriginal = null;\n    if (imagenDeBBDD.type.includes('image')) {\n      // Pasar buffer a string\n      bufferOriginal = Buffer.from(imagenDeBBDD.data);\n      // Pasar buffer a formato utf\n      imagenDeBBDD.data = bufferOriginal.toString('utf8');\n    } else {\n      Swal.fire({\n        position: 'top',\n        icon: 'error',\n        title: 'Sólo archivos de tipo imagen!',\n        showConfirmButton: false,\n        timer: 2000\n      });\n    }\n    return imagenDeBBDD;\n  }\n\n  async queryDepartments () {\n    await DepartmentService.getAll()\n      .then(res => {\n        if (res.data.success) {\n          const data = res.data.data;\n          this.state.departments = data;\n        } else {\n          console.error('Error web service');\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n  }\n\n  async queryRoles () {\n    await RoleService.getAll()\n      .then(res => {\n        if (res.data.success) {\n          const data = res.data.data;\n          this.state.roles = data;\n        } else {\n          console.error('Error web service');\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n  }\n\n  async queryTutors () {\n    await TutorService.getAll()\n      .then(res => {\n        if (res.data.success) {\n          const data = res.data.data;\n          this.state.tutors = data;\n        } else {\n          console.error('Error web service');\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n    return this.state.tutors;\n  }\n\n  async loadDepartments () {\n    await this.queryDepartments();\n    return this.state.departments.map(data => {\n      if (data) {\n        return (\n          <option value={data.id}>{data.name}</option>\n        );\n      } else {\n        return <div />;\n      }\n    });\n  }\n\n  async loadRoles () {\n    await this.queryRoles();\n    return this.state.roles.map(data => {\n      if (data) {\n        return (\n          <option value={data.id}>{data.name}</option>\n        );\n      } else {\n        return <div />;\n      }\n    });\n  }\n\n  async loadTutors () {\n    await this.queryTutors();\n    return this.state.tutors.map(data => {\n      if (data) {\n        return (\n          <option value={data.id}>{data.name}</option>\n        );\n      } else {\n        return <div />;\n      }\n    });\n  }\n\n  validateFields (nombre, departamentoId, roleId) {\n    let emptyFields = '';\n    let count = 0;\n\n    if (nombre.replace(/\\s/g, '').length == 0) {\n      emptyFields += ' Nombre ';\n      count++;\n    }\n    if (departamentoId == null) {\n      emptyFields += ' Departamento ';\n      count++;\n    }\n    if (roleId == null) {\n      emptyFields += ' Rol ';\n      count++;\n    }\n\n    // If there are errors\n    if (count > 0) {\n      Swal.fire({\n        position: 'center',\n        icon: 'error',\n        title: (count == 1 ? 'Falta el campo' : 'Faltan los campos: ') + emptyFields,\n        showConfirmButton: false,\n        timer: 2000\n      });\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  async addProfessional (datapost) {\n    const { name, departmentId, roleId } = datapost;\n    if (this.validateFields(name, departmentId, roleId) == false) {\n      return;\n    }\n\n    await ProfessionalService.create(datapost)\n      .then(async res => {\n        if (res.data.success) {\n          await Swal.fire({\n            position: 'top',\n            icon: 'success',\n            title: '¡Enhorabuena, ya tiene perfil!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          this.state.correctlyCreated = 'true';\n        } else {\n          console.error('Error creating professional');\n        }\n      }).catch(error => {\n        console.error('Error 34 ' + error);\n      });\n\n    return this.state.correctlyCreated;\n  }\n\n  updateProfessional (datapost) {\n    this.validateFields(datapost.name, datapost.departmentId, datapost.roleId);\n\n    ProfessionalService.update(datapost)\n      .then(res => {\n        if (res.data.success) {\n          Swal.fire({\n            position: 'top',\n            icon: 'success',\n            title: 'Profesional actualizado correctamente!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n        } else {\n          console.error('Error');\n        }\n      }).catch(error => {\n        console.error('Error 34 ' + error);\n      });\n  }\n\n  async readURL (input) {\n    return new Promise(function (resolve, reject) {\n      const miImagen = {};\n      if (input.files && input.files[0]) {\n        const myValue = input.files[0];\n\n        const random = Math.floor(((Math.random() * 100) + 1)) === 69;\n\n        if (random) {\n          Swal.fire({\n            position: 'top',\n            icon: 'success',\n            title: 'Esa imagen es muy grande para mi puertito!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        } else if (myValue.size > 2000000) {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Demasiado grande!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n\n        if (myValue.type.includes('image')) {\n          const reader = new FileReader();\n          reader.readAsDataURL(myValue);\n\n          reader.onload = (event) => {\n            const shaObj = new jsSHA3('SHA3-512', 'TEXT', { encoding: 'UTF8' });\n            shaObj.update(event.target.result);\n\n            miImagen.id = shaObj.getHash('HEX');\n            miImagen.data = event.target.result;\n            miImagen.name = myValue.name;\n            miImagen.type = myValue.type;\n\n            resolve(miImagen);\n          };\n          reader.onerror = (err) => {\n            console.error('Error en lectura de imagen --> ' + err);\n            reject(null);\n          };\n        } else {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Sólo archivos de tipo imagen!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n      }\n    });\n  }\n\n  checkImageExistence (datapost) {\n    console.log(datapost);\n    const { image } = datapost;\n\n    ImageService.get(image.id).then((res) => {\n      if (res.data.success) {\n        datapost.user.imageId = image.id;\n      }\n    });\n\n    return datapost;\n  }\n}\nexport default new profileController();\n"]},"metadata":{},"sourceType":"module"}