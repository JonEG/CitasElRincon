{"ast":null,"code":"var _jsxFileName = \"/Users/trabajo/Desktop/ELRINCON/frontend/src/controllers/profileController.js\";\nimport React, { Component } from 'react';\nimport ProfessionalService from '../services/professional.service';\nimport DepartmentService from '../services/department.service';\nimport TutorService from '../services/tutor.service';\nimport RoleService from '../services/role.service';\nimport ImageService from '../services/image.service';\nimport ProfileController from '../controllers/profileController';\nimport Swal from 'sweetalert2';\nimport { data } from 'jquery';\n\nconst jsSHA3 = require('jssha/dist/sha3');\n\nclass profileController {\n  constructor() {\n    this.state = {\n      email: sessionStorage.getItem('userEmail'),\n      response: {},\n      departments: [],\n      roles: [],\n      tutors: [],\n      correctlyCreated: 'false'\n    };\n  }\n\n  async loadUserId() {\n    await ProfessionalService.getWithEmail({\n      email: sessionStorage.getItem('userEmail')\n    }).then(res => {\n      if (res.data.success) {\n        this.state.response = {\n          redirect: '/',\n          allowCreation: false\n        };\n      } else {\n        this.state.response = {\n          redirect: null,\n          allowCreation: true\n        };\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return this.state.response;\n  }\n\n  async queryProfessionals() {\n    let myState = {};\n    await ProfessionalService.getWithEmail({\n      email: this.state.email\n    }).then(async res => {\n      if (res.data.success) {\n        const {\n          id,\n          name,\n          departmentId,\n          roleId,\n          tutorId,\n          comment,\n          imageId\n        } = res.data.data[0];\n        myState = {\n          id: id,\n          name: name,\n          departmentId: departmentId,\n          roleId: roleId,\n          tutorId: tutorId,\n          comment: comment,\n          imageId: imageId\n        };\n\n        if (imageId != null) {\n          await ImageService.get(imageId).then(res => {\n            myState.image = this.cargarImagenDeBBDD(res.data.data[0]);\n          }).catch(err => {\n            console.error('ERROR server ' + err);\n          });\n        } else {\n          console.error('No hay imagen asociada a esta cuenta.');\n        }\n      } else {\n        console.error('Error quering professional EDIT');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return myState;\n  }\n\n  cargarImagenDeBBDD(imagenDeBBDD) {\n    let bufferOriginal = null; // Pasar buffer a string\n\n    bufferOriginal = Buffer.from(imagenDeBBDD.data); // Pasar buffer a formato utf\n\n    imagenDeBBDD.data = bufferOriginal.toString('utf8');\n    const imageType = imagenDeBBDD.data.substring(0, 11);\n\n    if (imageType === 'data:image/') {\n      return imagenDeBBDD;\n    } else {\n      return null;\n    }\n  }\n\n  async queryDepartments() {\n    await DepartmentService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.departments = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n  }\n\n  async queryRoles() {\n    await RoleService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.roles = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n  }\n\n  async queryTutors() {\n    await TutorService.getAll().then(res => {\n      if (res.data.success) {\n        const data = res.data.data;\n        this.state.tutors = data;\n      } else {\n        console.error('Error web service');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return this.state.tutors;\n  }\n\n  async loadDepartments() {\n    await this.queryDepartments();\n    return this.state.departments.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 13\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 18\n          }\n        });\n      }\n    });\n  }\n\n  async loadRoles() {\n    await this.queryRoles();\n    return this.state.roles.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 18\n          }\n        });\n      }\n    });\n  }\n\n  async loadTutors() {\n    await this.queryTutors();\n    return this.state.tutors.map(data => {\n      if (data) {\n        return /*#__PURE__*/React.createElement(\"option\", {\n          value: data.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 13\n          }\n        }, data.name);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 18\n          }\n        });\n      }\n    });\n  }\n\n  validateFields(nombre, departamentoId, roleId) {\n    let emptyFields = '';\n    let count = 0;\n\n    if (nombre.replace(/\\s/g, '').length == 0) {\n      emptyFields += ' Nombre ';\n      count++;\n    }\n\n    if (departamentoId == null) {\n      emptyFields += ' Departamento ';\n      count++;\n    }\n\n    if (roleId == null) {\n      emptyFields += ' Rol ';\n      count++;\n    } // If there are errors\n\n\n    if (count > 0) {\n      Swal.fire({\n        position: 'center',\n        icon: 'error',\n        title: (count == 1 ? 'Falta el campo' : 'Faltan los campos: ') + emptyFields,\n        showConfirmButton: false,\n        timer: 2000\n      });\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  async addProfessional(datapost) {\n    const {\n      name,\n      departmentId,\n      roleId\n    } = datapost;\n\n    if (this.validateFields(name, departmentId, roleId) == false) {\n      return;\n    }\n\n    await ProfessionalService.create(datapost).then(async res => {\n      if (res.data.success) {\n        await Swal.fire({\n          position: 'top',\n          icon: 'success',\n          title: '¡Enhorabuena, ya tiene perfil!',\n          showConfirmButton: false,\n          timer: 2000\n        });\n        this.state.correctlyCreated = 'true';\n      } else {\n        console.error('Error creating professional');\n      }\n    }).catch(error => {\n      console.error('Error 34 ' + error);\n    });\n    return this.state.correctlyCreated;\n  }\n\n  updateProfessional(datapost) {\n    this.validateFields(datapost.name, datapost.departmentId, datapost.roleId);\n    ProfessionalService.update(datapost).then(res => {\n      if (res.data.success) {\n        Swal.fire({\n          position: 'top',\n          icon: 'success',\n          title: 'Profesional actualizado correctamente!',\n          showConfirmButton: false,\n          timer: 2000\n        });\n      } else {\n        console.error('Error');\n      }\n    }).catch(error => {\n      console.error('Error 34 ' + error);\n    });\n  }\n\n  async readURL(input) {\n    return new Promise(function (resolve, reject) {\n      const miImagen = {};\n\n      if (input.files && input.files[0]) {\n        const myValue = input.files[0];\n        const random = Math.floor(Math.random() * 100 + 1) === 69;\n\n        if (random) {\n          Swal.fire({\n            position: 'top',\n            icon: 'success',\n            title: 'Esa imagen es muy grande para mi puertito!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        } else if (myValue.size > 2000000) {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Demasiado grande!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n\n        if (myValue.type.includes('image')) {\n          const reader = new FileReader();\n          reader.readAsDataURL(myValue);\n\n          reader.onload = event => {\n            const shaObj = new jsSHA3('SHA3-512', 'TEXT', {\n              encoding: 'UTF8'\n            });\n            shaObj.update(event.target.result);\n            miImagen.id = shaObj.getHash('HEX');\n            miImagen.data = event.target.result;\n            resolve(miImagen);\n          };\n\n          reader.onerror = err => {\n            console.error('Error en lectura de imagen --> ' + err);\n            reject(null);\n          };\n        } else {\n          Swal.fire({\n            position: 'top',\n            icon: 'error',\n            title: 'Sólo archivos de tipo imagen!',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          console.error('Error en lectura de imagen');\n          reject(null);\n        }\n      }\n    });\n  }\n\n  checkImageExistence(datapost) {\n    console.log(datapost);\n    const {\n      image\n    } = datapost;\n    ImageService.get(image.id).then(res => {\n      if (res.data.success) {\n        datapost.user.imageId = image.id;\n      }\n    });\n    return datapost;\n  }\n\n}\n\nexport default new profileController();","map":{"version":3,"sources":["/Users/trabajo/Desktop/ELRINCON/frontend/src/controllers/profileController.js"],"names":["React","Component","ProfessionalService","DepartmentService","TutorService","RoleService","ImageService","ProfileController","Swal","data","jsSHA3","require","profileController","constructor","state","email","sessionStorage","getItem","response","departments","roles","tutors","correctlyCreated","loadUserId","getWithEmail","then","res","success","redirect","allowCreation","catch","err","console","error","queryProfessionals","myState","id","name","departmentId","roleId","tutorId","comment","imageId","get","image","cargarImagenDeBBDD","imagenDeBBDD","bufferOriginal","Buffer","from","toString","imageType","substring","queryDepartments","getAll","queryRoles","queryTutors","loadDepartments","map","loadRoles","loadTutors","validateFields","nombre","departamentoId","emptyFields","count","replace","length","fire","position","icon","title","showConfirmButton","timer","addProfessional","datapost","create","updateProfessional","update","readURL","input","Promise","resolve","reject","miImagen","files","myValue","random","Math","floor","size","type","includes","reader","FileReader","readAsDataURL","onload","event","shaObj","encoding","target","result","getHash","onerror","checkImageExistence","log","user"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ProfessionalService from '../services/professional.service';\nimport DepartmentService from '../services/department.service';\nimport TutorService from '../services/tutor.service';\nimport RoleService from '../services/role.service';\nimport ImageService from '../services/image.service';\nimport ProfileController from '../controllers/profileController';\n\nimport Swal from 'sweetalert2';\nimport { data } from 'jquery';\n\nconst jsSHA3 = require('jssha/dist/sha3');\n\nclass profileController {\n  constructor() {\n    this.state = {\n      email: sessionStorage.getItem('userEmail'),\n      response: {},\n      departments: [],\n      roles: [],\n      tutors: [],\n      correctlyCreated: 'false'\n    };\n  }\n\n  async loadUserId() {\n    await ProfessionalService.getWithEmail({ email: sessionStorage.getItem('userEmail') })\n      .then(res => {\n        if (res.data.success) {\n          this.state.response = { redirect: '/', allowCreation: false };\n        } else {\n          this.state.response = { redirect: null, allowCreation: true };\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n    return this.state.response;\n  }\n\n  async queryProfessionals() {\n    let myState = {};\n    await ProfessionalService.getWithEmail({ email: this.state.email })\n      .then(async res => {\n        if (res.data.success) {\n          const { id, name, departmentId, roleId, tutorId, comment, imageId } = res.data.data[0];\n\n          myState = {\n            id: id,\n            name: name,\n            departmentId: departmentId,\n            roleId: roleId,\n            tutorId: tutorId,\n            comment: comment,\n            imageId: imageId\n          };\n\n          if (imageId != null) {\n            await ImageService.get(imageId).then(res => {\n              myState.image = this.cargarImagenDeBBDD(res.data.data[0]);\n            }).catch(err => {\n              console.error('ERROR server ' + err);\n            });\n          } else {\n            console.error('No hay imagen asociada a esta cuenta.');\n          }\n        } else {\n          console.error('Error quering professional EDIT');\n        }\n      })\n      .catch(err => {\n        console.error('ERROR server' + err);\n      });\n    return myState;\n  }\n\n  cargarImagenDeBBDD(imagenDeBBDD) {\n    let bufferOriginal = null;\n    // Pasar buffer a string\n    bufferOriginal = Buffer.from(imagenDeBBDD.data);\n    // Pasar buffer a formato utf\n    imagenDeBBDD.data = bufferOriginal.toString('utf8');\n\n    const imageType = imagenDeBBDD.data.substring(0, 11);\n    if (imageType === 'data:image/') {\n      return imagenDeBBDD;\n    }else{\n      return null;\n    }\n  }\n      \n    \n\n    async queryDepartments() {\n      await DepartmentService.getAll()\n        .then(res => {\n          if (res.data.success) {\n            const data = res.data.data;\n            this.state.departments = data;\n          } else {\n            console.error('Error web service');\n          }\n        })\n        .catch(err => {\n          console.error('ERROR server' + err);\n        });\n    }\n\n    async queryRoles() {\n      await RoleService.getAll()\n        .then(res => {\n          if (res.data.success) {\n            const data = res.data.data;\n            this.state.roles = data;\n          } else {\n            console.error('Error web service');\n          }\n        })\n        .catch(err => {\n          console.error('ERROR server' + err);\n        });\n    }\n\n    async queryTutors() {\n      await TutorService.getAll()\n        .then(res => {\n          if (res.data.success) {\n            const data = res.data.data;\n            this.state.tutors = data;\n          } else {\n            console.error('Error web service');\n          }\n        })\n        .catch(err => {\n          console.error('ERROR server' + err);\n        });\n      return this.state.tutors;\n    }\n\n    async loadDepartments() {\n      await this.queryDepartments();\n      return this.state.departments.map(data => {\n        if (data) {\n          return (\n            <option value={data.id}>{data.name}</option>\n          );\n        } else {\n          return <div />;\n        }\n      });\n    }\n\n    async loadRoles() {\n      await this.queryRoles();\n      return this.state.roles.map(data => {\n        if (data) {\n          return (\n            <option value={data.id}>{data.name}</option>\n          );\n        } else {\n          return <div />;\n        }\n      });\n    }\n\n    async loadTutors() {\n      await this.queryTutors();\n      return this.state.tutors.map(data => {\n        if (data) {\n          return (\n            <option value={data.id}>{data.name}</option>\n          );\n        } else {\n          return <div />;\n        }\n      });\n    }\n\n    validateFields(nombre, departamentoId, roleId) {\n      let emptyFields = '';\n      let count = 0;\n\n      if (nombre.replace(/\\s/g, '').length == 0) {\n        emptyFields += ' Nombre ';\n        count++;\n      }\n      if (departamentoId == null) {\n        emptyFields += ' Departamento ';\n        count++;\n      }\n      if (roleId == null) {\n        emptyFields += ' Rol ';\n        count++;\n      }\n\n      // If there are errors\n      if (count > 0) {\n        Swal.fire({\n          position: 'center',\n          icon: 'error',\n          title: (count == 1 ? 'Falta el campo' : 'Faltan los campos: ') + emptyFields,\n          showConfirmButton: false,\n          timer: 2000\n        });\n        return false;\n      } else {\n        return true;\n      }\n    }\n\n    async addProfessional(datapost) {\n      const { name, departmentId, roleId } = datapost;\n      if (this.validateFields(name, departmentId, roleId) == false) {\n        return;\n      }\n\n      await ProfessionalService.create(datapost)\n        .then(async res => {\n          if (res.data.success) {\n            await Swal.fire({\n              position: 'top',\n              icon: 'success',\n              title: '¡Enhorabuena, ya tiene perfil!',\n              showConfirmButton: false,\n              timer: 2000\n            });\n            this.state.correctlyCreated = 'true';\n          } else {\n            console.error('Error creating professional');\n          }\n        }).catch(error => {\n          console.error('Error 34 ' + error);\n        });\n\n      return this.state.correctlyCreated;\n    }\n\n    updateProfessional(datapost) {\n      this.validateFields(datapost.name, datapost.departmentId, datapost.roleId);\n\n      ProfessionalService.update(datapost)\n        .then(res => {\n          if (res.data.success) {\n            Swal.fire({\n              position: 'top',\n              icon: 'success',\n              title: 'Profesional actualizado correctamente!',\n              showConfirmButton: false,\n              timer: 2000\n            });\n          } else {\n            console.error('Error');\n          }\n        }).catch(error => {\n          console.error('Error 34 ' + error);\n        });\n    }\n\n    async readURL(input) {\n      return new Promise(function (resolve, reject) {\n        const miImagen = {};\n        if (input.files && input.files[0]) {\n          const myValue = input.files[0];\n\n          const random = Math.floor(((Math.random() * 100) + 1)) === 69;\n\n          if (random) {\n            Swal.fire({\n              position: 'top',\n              icon: 'success',\n              title: 'Esa imagen es muy grande para mi puertito!',\n              showConfirmButton: false,\n              timer: 2000\n            });\n            console.error('Error en lectura de imagen');\n            reject(null);\n          } else if (myValue.size > 2000000) {\n            Swal.fire({\n              position: 'top',\n              icon: 'error',\n              title: 'Demasiado grande!',\n              showConfirmButton: false,\n              timer: 2000\n            });\n            console.error('Error en lectura de imagen');\n            reject(null);\n          }\n\n          if (myValue.type.includes('image')) {\n            const reader = new FileReader();\n            reader.readAsDataURL(myValue);\n\n            reader.onload = (event) => {\n              const shaObj = new jsSHA3('SHA3-512', 'TEXT', { encoding: 'UTF8' });\n              shaObj.update(event.target.result);\n\n              miImagen.id = shaObj.getHash('HEX');\n              miImagen.data = event.target.result;\n\n              resolve(miImagen);\n            };\n            reader.onerror = (err) => {\n              console.error('Error en lectura de imagen --> ' + err);\n              reject(null);\n            };\n          } else {\n            Swal.fire({\n              position: 'top',\n              icon: 'error',\n              title: 'Sólo archivos de tipo imagen!',\n              showConfirmButton: false,\n              timer: 2000\n            });\n            console.error('Error en lectura de imagen');\n            reject(null);\n          }\n        }\n      });\n    }\n\n    checkImageExistence(datapost) {\n      console.log(datapost);\n      const { image } = datapost;\n\n      ImageService.get(image.id).then((res) => {\n        if (res.data.success) {\n          datapost.user.imageId = image.id;\n        }\n      });\n\n      return datapost;\n    }\n  }\nexport default new profileController();\n"]},"metadata":{},"sourceType":"module"}