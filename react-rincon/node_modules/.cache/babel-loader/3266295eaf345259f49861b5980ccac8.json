{"ast":null,"code":"import ProfessionalService from '../services/professional.service';\nimport TimetableService from '../services/timetable.service';\nimport Swal from 'sweetalert2';\n\nclass timetableController {\n  constructor() {\n    this.handleChange = async (time, day) => {\n      if (time == null) return;\n      const filteredTime = await String(time).match(/\\d{2}:\\d{2}/g)[0];\n\n      switch (day) {\n        case \"mondayFrom\":\n          this.state.monday.myDateFrom = time;\n          this.state.monday.from = filteredTime;\n          return this.state.monday;\n\n        case \"mondayTo\":\n          this.state.monday.myDateTo = time;\n          this.state.monday.to = filteredTime;\n          return this.state.monday;\n\n        case \"tuesdayFrom\":\n          this.state.tuesday.myDateFrom = time;\n          this.state.tuesday.from = filteredTime;\n          return this.state.tuesday;\n\n        case \"tuesdayTo\":\n          this.state.tuesday.myDateTo = time;\n          this.state.tuesday.to = filteredTime;\n          return this.state.tuesday;\n\n        case \"wednesdayFrom\":\n          this.state.wednesday.myDateFrom = time;\n          this.state.wednesday.from = filteredTime;\n          return this.state.wednesday;\n\n        case \"wednesdayTo\":\n          this.state.wednesday.myDateTo = time;\n          this.state.wednesday.to = filteredTime;\n          return this.state.wednesday;\n\n        case \"thursdayFrom\":\n          this.state.thursday.myDateFrom = time;\n          this.state.thursday.from = filteredTime;\n          return this.state.thursday;\n\n        case \"thursdayTo\":\n          this.state.thursday.myDateTo = time;\n          this.state.thursday.to = filteredTime;\n          return this.state.thursday;\n\n        case \"fridayFrom\":\n          this.state.friday.myDateFrom = time;\n          this.state.friday.from = filteredTime;\n          return this.state.friday;\n\n        case \"fridayTo\":\n          this.state.friday.myDateTo = time;\n          this.state.friday.to = filteredTime;\n          return this.state.friday;\n\n        default:\n          break;\n      }\n    };\n\n    this.state = {\n      myUser: null,\n      userId: sessionStorage.getItem(\"userId\"),\n      tableId: null,\n      periodLenght: 30,\n      monday: {\n        myDateFrom: null,\n        from: \"\",\n        myDateTo: null,\n        to: \"\"\n      },\n      tuesday: {\n        myDateFrom: null,\n        from: \"\",\n        myDateTo: null,\n        to: \"\"\n      },\n      wednesday: {\n        myDateFrom: null,\n        from: \"\",\n        myDateTo: null,\n        to: \"\"\n      },\n      thursday: {\n        myDateFrom: null,\n        from: \"\",\n        myDateTo: null,\n        to: \"\"\n      },\n      friday: {\n        myDateFrom: null,\n        from: \"\",\n        myDateTo: null,\n        to: \"\"\n      },\n      mondayDDBB: null,\n      tuesdayDDBB: null,\n      wednesdayDDBB: null,\n      thursdayDDB: null,\n      fridayDDBB: null\n    };\n  }\n\n  async queryTimetable() {\n    await ProfessionalService.get(this.state.userId).then(res => {\n      if (res.data.success) {\n        this.state.myUser = res.data.data[0];\n        const {\n          id,\n          monday,\n          tuesday,\n          wednesday,\n          thursday,\n          friday\n        } = this.state.myUser.timetable;\n        this.state.tableId = id;\n\n        if (monday != null) {\n          this.state.mondayDDBB = monday;\n        }\n\n        if (tuesday != null) {\n          this.state.tuesdayDDBB = tuesday;\n        }\n\n        if (wednesday != null) {\n          this.state.wednesdayDDBB = wednesday;\n        }\n\n        if (thursday != null) {\n          this.state.thursdayDDB = thursday;\n        }\n\n        if (friday != null) {\n          this.state.fridayDDBB = friday;\n        }\n      } else {\n        console.error('Error quering timetable');\n      }\n    }).catch(err => {\n      console.error('ERROR server' + err);\n    });\n    return {\n      monday: this.state.mondayDDBB,\n      tuesday: this.state.tuesdayDDBB,\n      wednesday: this.state.wednesdayDDBB,\n      thursday: this.state.thursdayDDB,\n      friday: this.state.fridayDDBB\n    };\n  }\n\n  async addPeriod(day) {\n    const week = {\n      id: this.state.tableId,\n      professionalId: this.state.userId,\n      monday: this.state.mondayDDBB,\n      tuesday: this.state.tuesdayDDBB,\n      wednesday: this.state.wednesdayDDBB,\n      thursday: this.state.thursdayDDB,\n      friday: this.state.fridayDDBB\n    };\n\n    switch (day) {\n      case 'monday':\n        console.log(this.state.monday.from + this.state.monday.to);\n\n        if (this.state.monday.from && this.state.monday.to) {\n          week.monday = this.state.monday.from + \"-\" + this.state.monday.to;\n          this.updateTimetable(week);\n        }\n\n        break;\n        break;\n\n      case 'tuesday':\n        if (this.state.tuesday.from && this.state.tuesday.to) {\n          week.tuesday = this.state.tuesday.from + \"-\" + this.state.tuesday.to;\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'wednesday':\n        if (this.state.wednesday.from && this.state.wednesday.to) {\n          week.wednesday = this.state.wednesday.from + \"-\" + this.state.wednesday.to;\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'thursday':\n        if (this.state.thursday.from && this.state.thursday.to) {\n          week.thursday = this.state.thursday.from + \"-\" + this.state.thursday.to;\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'friday':\n        if (this.state.friday.from && this.state.friday.to) {\n          week.friday = this.state.friday.from + \"-\" + this.state.friday.to;\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  async emptyPeriod(day) {\n    let aux;\n    const week = {\n      id: this.state.tableId,\n      professionalId: this.state.userId,\n      monday: this.state.mondayDDBB,\n      tuesday: this.state.tuesdayDDBB,\n      wednesday: this.state.wednesdayDDBB,\n      thursday: this.state.thursdayDDB,\n      friday: this.state.fridayDDBB\n    };\n\n    if (this.state.tableId == null) {\n      await TimetableService.create({\n        professionalId: this.state.userId,\n        monday: null,\n        tuesday: null,\n        wednesday: null,\n        thursday: null,\n        friday: null\n      }).then(res => {\n        this.setState({\n          tableId: res.data.id\n        });\n      }).catch(console.error(\"error creando timetable\"));\n    }\n\n    switch (day) {\n      case 'monday':\n        aux = await this.showConfirmNotification('Lunes');\n\n        if (aux.isConfirmed) {\n          //vaciamos el día\n          week.monday = \"\";\n          await this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'tuesday':\n        aux = await this.showConfirmNotification('Martes');\n\n        if (aux.isConfirmed) {\n          //vaciamos el día\n          week.tuesday = \"\";\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'wednesday':\n        aux = await this.showConfirmNotification('Miércoles');\n\n        if (aux.isConfirmed) {\n          //vaciamos el día\n          week.wednesday = \"\";\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'thursday':\n        aux = await this.showConfirmNotification('Jueves');\n\n        if (aux.isConfirmed) {\n          //vaciamos el día\n          week.thursday = \"\";\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      case 'friday':\n        aux = await this.showConfirmNotification('Viernes');\n\n        if (aux.isConfirmed) {\n          //vaciamos el día\n          week.friday = \"\";\n          this.updateTimetable(week);\n        }\n\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  async showConfirmNotification(day) {\n    let aux = null;\n    await Swal.fire({\n      title: `Vaciar ${day}`,\n      text: \"¿Desea vaciar el día?\",\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      cancelButtonText: 'Cancelar!',\n      confirmButtonText: 'Confirmar'\n    }).then(async res => {\n      if (res.isConfirmed) {\n        await Swal.fire('Eliminado!', 'Se ha vaciado el día.', 'success');\n      }\n\n      aux = res;\n    });\n    return aux;\n  }\n\n  async updateTimetable(week) {\n    let updated = false;\n\n    if (week.id == null) {\n      await TimetableService.create(week).then(res => {\n        this.state.myUser.timetableId = res.data.id;\n        ProfessionalService.update(this.state.myUser).then(() => {\n          Swal.fire({\n            toast: true,\n            title: \"Horario actualizado\",\n            position: 'top-end',\n            icon: 'success',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          updated = true; //this.setState({ reloadTable: true })\n        }).catch(error => console.error(\"error creating timetable \" + error));\n      }).catch(error => console.error(\"error creating timetable \" + error));\n    } else {\n      await TimetableService.update(week).then(res => {\n        if (res.data.success == true) {\n          //this.setState({ reloadTable: true })\n          Swal.fire({\n            toast: true,\n            title: \"Horario actualizado\",\n            position: 'top-end',\n            icon: 'success',\n            showConfirmButton: false,\n            timer: 2000\n          });\n          updated = true;\n        }\n      }).catch(error => console.error(\"error actualizando timetable \" + error));\n    }\n\n    return updated;\n  }\n\n}\n\nexport default new timetableController();","map":{"version":3,"sources":["/Users/trabajo/Desktop/ELRINCON/react-rincon/src/controllers/timetableController.js"],"names":["ProfessionalService","TimetableService","Swal","timetableController","constructor","handleChange","time","day","filteredTime","String","match","state","monday","myDateFrom","from","myDateTo","to","tuesday","wednesday","thursday","friday","myUser","userId","sessionStorage","getItem","tableId","periodLenght","mondayDDBB","tuesdayDDBB","wednesdayDDBB","thursdayDDB","fridayDDBB","queryTimetable","get","then","res","data","success","id","timetable","console","error","catch","err","addPeriod","week","professionalId","log","updateTimetable","emptyPeriod","aux","create","setState","showConfirmNotification","isConfirmed","fire","title","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","cancelButtonText","confirmButtonText","updated","timetableId","update","toast","position","showConfirmButton","timer"],"mappings":"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","sourcesContent":["import ProfessionalService from '../services/professional.service';\nimport TimetableService from '../services/timetable.service';\nimport Swal from 'sweetalert2';\n\nclass timetableController {\n    constructor() {\n        this.state = {\n            myUser: null,\n            userId: sessionStorage.getItem(\"userId\"),\n            tableId: null,\n            periodLenght: 30,\n            monday: {\n                myDateFrom: null,\n                from: \"\",\n                myDateTo: null,\n                to: \"\"\n            },\n            tuesday: {\n                myDateFrom: null,\n                from: \"\",\n                myDateTo: null,\n                to: \"\"\n            },\n            wednesday: {\n                myDateFrom: null,\n                from: \"\",\n                myDateTo: null,\n                to: \"\"\n            },\n            thursday: {\n                myDateFrom: null,\n                from: \"\",\n                myDateTo: null,\n                to: \"\"\n            },\n            friday: {\n                myDateFrom: null,\n                from: \"\",\n                myDateTo: null,\n                to: \"\"\n            },\n            mondayDDBB: null,\n            tuesdayDDBB: null,\n            wednesdayDDBB: null,\n            thursdayDDB: null,\n            fridayDDBB: null\n        }\n    }\n\n    async queryTimetable() {\n        await ProfessionalService.get(this.state.userId).then(res => {\n            if (res.data.success) {\n                this.state.myUser = res.data.data[0];\n                const { id, monday, tuesday, wednesday, thursday, friday } = (this.state.myUser.timetable);\n                this.state.tableId = id;\n                if (monday != null) {\n                    this.state.mondayDDBB = monday; \n                }\n                if (tuesday != null) {\n                    this.state.tuesdayDDBB = tuesday;\n                }\n                if (wednesday != null) {\n                    this.state.wednesdayDDBB = wednesday;\n                }\n                if (thursday != null) {\n                    this.state.thursdayDDB = thursday;\n                }\n                if (friday != null) {\n                    this.state.fridayDDBB = friday;\n                }\n                \n            } else {\n                console.error('Error quering timetable');\n            }\n        }).catch(err => {\n            console.error('ERROR server' + err);\n        });\n\n        return {\n            monday: this.state.mondayDDBB,\n            tuesday: this.state.tuesdayDDBB,\n            wednesday: this.state.wednesdayDDBB,\n            thursday: this.state.thursdayDDB,\n            friday: this.state.fridayDDBB\n        }\n    }\n\n    handleChange = async (time, day) => {\n        if (time == null) return;\n        const filteredTime = await String(time).match(/\\d{2}:\\d{2}/g)[0];\n        switch (day) {\n            case \"mondayFrom\":\n                this.state.monday.myDateFrom = time;\n                this.state.monday.from = filteredTime;\n                return this.state.monday;\n            case \"mondayTo\":\n                this.state.monday.myDateTo = time;\n                this.state.monday.to = filteredTime;\n                return this.state.monday;\n            case \"tuesdayFrom\":\n                this.state.tuesday.myDateFrom = time;\n                this.state.tuesday.from = filteredTime;\n                return this.state.tuesday;\n            case \"tuesdayTo\":\n                this.state.tuesday.myDateTo = time;\n                this.state.tuesday.to = filteredTime;\n                return this.state.tuesday;\n            case \"wednesdayFrom\":\n                this.state.wednesday.myDateFrom = time;\n                this.state.wednesday.from = filteredTime;\n                return this.state.wednesday;\n            case \"wednesdayTo\":\n                this.state.wednesday.myDateTo = time;\n                this.state.wednesday.to = filteredTime;\n                return this.state.wednesday;\n            case \"thursdayFrom\":\n                this.state.thursday.myDateFrom = time;\n                this.state.thursday.from = filteredTime;\n                return this.state.thursday;\n            case \"thursdayTo\":\n                this.state.thursday.myDateTo = time;\n                this.state.thursday.to = filteredTime;\n                return this.state.thursday;\n            case \"fridayFrom\":\n                this.state.friday.myDateFrom = time;\n                this.state.friday.from = filteredTime;\n                return this.state.friday;\n            case \"fridayTo\":\n                this.state.friday.myDateTo = time;\n                this.state.friday.to = filteredTime;\n                return this.state.friday;\n\n            default:\n                break;\n        }\n    };\n\n    async addPeriod(day) {\n        const week = {\n            id: this.state.tableId,\n            professionalId: this.state.userId,\n            monday: this.state.mondayDDBB,\n            tuesday: this.state.tuesdayDDBB,\n            wednesday: this.state.wednesdayDDBB,\n            thursday: this.state.thursdayDDB,\n            friday: this.state.fridayDDBB\n        }\n\n        switch (day) {\n            case 'monday':\n                console.log(this.state.monday.from + this.state.monday.to);\n                if (this.state.monday.from && this.state.monday.to) {\n                    week.monday = this.state.monday.from + \"-\" + this.state.monday.to;\n                    this.updateTimetable(week);\n                }\n                break;\n                break;\n            case 'tuesday':\n                if (this.state.tuesday.from && this.state.tuesday.to) {\n                    week.tuesday = this.state.tuesday.from + \"-\" + this.state.tuesday.to;\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'wednesday':\n                if (this.state.wednesday.from && this.state.wednesday.to) {\n                    week.wednesday = this.state.wednesday.from + \"-\" + this.state.wednesday.to;\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'thursday':\n                if (this.state.thursday.from && this.state.thursday.to) {\n                    week.thursday = this.state.thursday.from + \"-\" + this.state.thursday.to;\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'friday':\n                if (this.state.friday.from && this.state.friday.to) {\n                    week.friday = this.state.friday.from + \"-\" + this.state.friday.to;\n                    this.updateTimetable(week);\n                }\n                break;\n\n            default:\n                break;\n        }\n\n    }\n\n    async emptyPeriod(day) {\n        let aux;\n        const week = {\n            id: this.state.tableId,\n            professionalId: this.state.userId,\n            monday: this.state.mondayDDBB,\n            tuesday: this.state.tuesdayDDBB,\n            wednesday: this.state.wednesdayDDBB,\n            thursday: this.state.thursdayDDB,\n            friday: this.state.fridayDDBB\n        }\n\n        if (this.state.tableId == null) {\n            await TimetableService.create({\n                professionalId: this.state.userId,\n                monday: null,\n                tuesday: null,\n                wednesday: null,\n                thursday: null,\n                friday: null\n            })\n                .then(res => {\n                    this.setState({ tableId: res.data.id });\n                })\n                .catch(\n                    console.error(\"error creando timetable\")\n                );\n        }\n\n        switch (day) {\n            case 'monday':\n                aux = await this.showConfirmNotification('Lunes');\n                if (aux.isConfirmed) {\n                    //vaciamos el día\n                    week.monday = \"\";\n                    await this.updateTimetable(week);\n                }\n                break;\n            case 'tuesday':\n                aux = await this.showConfirmNotification('Martes');\n                if (aux.isConfirmed) {\n                    //vaciamos el día\n                    week.tuesday = \"\";\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'wednesday':\n                aux = await this.showConfirmNotification('Miércoles');\n                if (aux.isConfirmed) {\n                    //vaciamos el día\n                    week.wednesday = \"\";\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'thursday':\n                aux = await this.showConfirmNotification('Jueves');\n                if (aux.isConfirmed) {\n                    //vaciamos el día\n                    week.thursday = \"\";\n                    this.updateTimetable(week);\n                }\n                break;\n            case 'friday':\n                aux = await this.showConfirmNotification('Viernes');\n                if (aux.isConfirmed) {\n                    //vaciamos el día\n                    week.friday = \"\";\n                    this.updateTimetable(week);\n                }\n                break;\n\n            default:\n                break;\n        }\n    }\n\n    async showConfirmNotification(day) {\n        let aux = null;\n        await Swal.fire({\n            title: `Vaciar ${day}`,\n            text: \"¿Desea vaciar el día?\",\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: '#3085d6',\n            cancelButtonColor: '#d33',\n            cancelButtonText: 'Cancelar!',\n            confirmButtonText: 'Confirmar'\n        }).then(async (res) => {\n            if (res.isConfirmed) {\n                await Swal.fire(\n                    'Eliminado!',\n                    'Se ha vaciado el día.',\n                    'success'\n                );\n            }\n            aux = res;\n        });\n        return aux;\n    }\n\n    async updateTimetable(week) {\n        let updated = false;\n        if (week.id == null) {\n            await TimetableService.create(week).then((res) => {\n                this.state.myUser.timetableId = res.data.id;\n                ProfessionalService.update(this.state.myUser).then(() => {\n                    Swal.fire({\n                        toast: true,\n                        title: \"Horario actualizado\",\n                        position: 'top-end',\n                        icon: 'success',\n                        showConfirmButton: false,\n                        timer: 2000\n                    });\n                    updated = true;\n                    //this.setState({ reloadTable: true })\n                }).catch((error) => console.error(\"error creating timetable \" + error));\n\n            }).catch((error) => console.error(\"error creating timetable \" + error))\n        } else {\n            await TimetableService.update(week).then((res) => {\n                if (res.data.success == true) {\n                    //this.setState({ reloadTable: true })\n                    Swal.fire({\n                        toast: true,\n                        title: \"Horario actualizado\",\n                        position: 'top-end',\n                        icon: 'success',\n                        showConfirmButton: false,\n                        timer: 2000\n                    });\n                    updated = true;\n                }\n            }).catch((error) => console.error(\"error actualizando timetable \" + error));\n        }\n        return updated;\n    }\n\n}\n\nexport default new timetableController();"]},"metadata":{},"sourceType":"module"}