{"ast":null,"code":"import _regeneratorRuntime from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/trabajo/Desktop/ELRINCON/react-rincon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'../../node_modules/bootstrap/dist/css/bootstrap.min.css';import'../../node_modules/bootstrap/dist/js/bootstrap.bundle.min';import ProfessionalService from'../services/professional.service';import DepartmentService from'../services/department.service';import TutorService from'../services/tutor.service';import RoleService from'../services/role.service';import ImageService from'../services/image.service';import Swal from'sweetalert2';import $ from'jquery';var profileComponent=/*#__PURE__*/function(_React$Component){_inherits(profileComponent,_React$Component);var _super=_createSuper(profileComponent);function profileComponent(props){var _this;_classCallCheck(this,profileComponent);_this=_super.call(this,props);_this.state={departments:[],roles:[],tutors:[],id:null,name:null,departmentId:null,roleId:null,email:sessionStorage.getItem(\"userEmail\"),tutorId:null,comment:\"\",image:null,imageId:null};return _this;}_createClass(profileComponent,[{key:\"componentDidMount\",value:function componentDidMount(){//Professional info\nthis.queryProfessionals();//Dropdowns\nthis.queryDepartments();this.queryRoles();this.queryTutors();}},{key:\"queryProfessionals\",value:function queryProfessionals(){var _this2=this;ProfessionalService.getWithEmail({email:this.state.email}).then(function(res){if(res.data.success){var _res$data$data$=res.data.data[0],id=_res$data$data$.id,name=_res$data$data$.name,departmentId=_res$data$data$.departmentId,roleId=_res$data$data$.roleId,tutorId=_res$data$data$.tutorId,comment=_res$data$data$.comment,imageId=_res$data$data$.imageId;_this2.setState({id:id,name:name,departmentId:departmentId,roleId:roleId,tutorId:tutorId,comment:comment,imageId:imageId});if(imageId!=null){ImageService.get(imageId).then(function(res){_this2.setState({image:res.data.data[0]});//console.log(\"MI IMAGEN \"+JSON.stringify(this.state.image));\n_this2.cargarImagen(_this2.state.image);}).catch(function(err){console.log('ERROR server '+err);});}else{console.log('No hay imagen asociada a esta cuenta.');}//this.setState(id,name,departmentId,roleId,tutorId,comment,imageId);\n}else{console.log('Error quering professional EDIT');}}).catch(function(err){console.log('ERROR server'+err);});}},{key:\"queryDepartments\",value:function queryDepartments(){var _this3=this;DepartmentService.getAll().then(function(res){if(res.data.success){var data=res.data.data;_this3.setState({departments:data});}else{console.log('Error quering departments EDIT');}}).catch(function(err){console.log('ERROR server'+err);});}},{key:\"queryRoles\",value:function queryRoles(){var _this4=this;RoleService.getAll().then(function(res){if(res.data.success){var data=res.data.data;_this4.setState({roles:data});}else{console.log('Error quering roles EDIT');}}).catch(function(err){console.log('ERROR server'+err);});}},{key:\"queryTutors\",value:function queryTutors(){var _this5=this;TutorService.getAll().then(function(res){if(res.data.success){var data=res.data.data;_this5.setState({tutors:data});}else{console.log('Error quering tutors EDIT');}}).catch(function(err){console.log('ERROR server'+err);});}},{key:\"render\",value:function render(){var _this6=this;return/*#__PURE__*/React.createElement(\"div\",{class:\"container p-4\"},/*#__PURE__*/React.createElement(\"script\",{src:\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"}),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"col-lg-9\"},/*#__PURE__*/React.createElement(\"div\",{class:\"card\"},/*#__PURE__*/React.createElement(\"div\",{class:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group \"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",value:this.state.name,onChange:function onChange(value){return _this6.setState({name:value.target.value});},class:\"form-control\",name:\"nombre\",placeholder:\"Nombre\",autofocus:true})),/*#__PURE__*/React.createElement(\"div\",{class:\"row\"},/*#__PURE__*/React.createElement(\"div\",{class:\"col-lg-3\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group\"},/*#__PURE__*/React.createElement(\"select\",{class:\"form-control\",value:this.state.departmentId,onChange:function onChange(value){return _this6.setState({departmentId:value.target.value});}},/*#__PURE__*/React.createElement(\"option\",{selected:true,disabled:true},\"Departamento\"),this.loadDepartments()))),/*#__PURE__*/React.createElement(\"div\",{class:\"col-lg-2\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group\"},/*#__PURE__*/React.createElement(\"select\",{class:\"form-control\",value:this.state.roleId,onChange:function onChange(value){return _this6.setState({roleId:value.target.value});}},/*#__PURE__*/React.createElement(\"option\",{selected:true,disabled:true},\"Rol\"),this.loadRoles()))),/*#__PURE__*/React.createElement(\"div\",{class:\"col-lg-3\"},/*#__PURE__*/React.createElement(\"div\",{class:\"form-group\"},/*#__PURE__*/React.createElement(\"select\",{class:\"form-control\",value:this.state.tutorId,onChange:function onChange(value){return _this6.setState({tutorId:value.target.value});}},/*#__PURE__*/React.createElement(\"option\",{selected:true,disabled:true},\"Tutor\\xEDa\"),this.loadTutors())))),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group\"},/*#__PURE__*/React.createElement(\"textarea\",{class:\"form-control\",value:this.state.comment,onChange:function onChange(value){return _this6.setState({comment:value.target.value});},placeholder:\"Introduzca si lo desea alg\\xFAn comentario: Me gusta J\",rows:\"3\"})),/*#__PURE__*/React.createElement(\"div\",{class:\"form-group\"},/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",class:\"btn btn-success\",onClick:function onClick(){return _this6.updateProfessional();}},\"Actualizar\"))))),/*#__PURE__*/React.createElement(\"div\",{class:\"col-lg-3\"},/*#__PURE__*/React.createElement(\"div\",{class:\"card\"},/*#__PURE__*/React.createElement(\"div\",{class:\"card-body text-center\"},/*#__PURE__*/React.createElement(\"form\",{class:\"md-form\"},/*#__PURE__*/React.createElement(\"div\",{class:\"file-field\"},/*#__PURE__*/React.createElement(\"div\",{class:\"md-4\"},/*#__PURE__*/React.createElement(\"img\",{src:require(\"../images/profile-picture.jpg\"),ref:function ref(profilePicture){return _this6.myProfilePicture=profilePicture;},id:\"blah\",class:\"rounded-circle z-depth-1-half avatar-pic img-fluid img-thumbnail\",alt:\"avatar\"}),/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:\"10px\"},class:\"d-flex\"},/*#__PURE__*/React.createElement(\"div\",{class:\"btn btn-mdb-color btn-rounded float-left custom-file\"},/*#__PURE__*/React.createElement(\"input\",{style:{width:\"100%\"},ref:function ref(myElement){return _this6.myFileElement=myElement;},type:\"file\",id:\"imgInput\",className:\"custom-file-input btn btn-primary\",onChange:function onChange(value){_this6.readURL(value.target);}}),/*#__PURE__*/React.createElement(\"label\",{class:\"custom-file-label\",for:\"customFile\"},\"Perfil\")))))))))));}},{key:\"loadDepartments\",value:function loadDepartments(){return this.state.departments.map(function(data){if(data){return/*#__PURE__*/React.createElement(\"option\",{value:data.id},data.name);}else{return/*#__PURE__*/React.createElement(\"div\",null);}});}},{key:\"loadRoles\",value:function loadRoles(){return this.state.roles.map(function(data){if(data){return/*#__PURE__*/React.createElement(\"option\",{value:data.id},data.name);}else{return/*#__PURE__*/React.createElement(\"div\",null);}});}},{key:\"loadTutors\",value:function loadTutors(){return this.state.tutors.map(function(data){if(data){return/*#__PURE__*/React.createElement(\"option\",{value:data.id},data.name);}else{return/*#__PURE__*/React.createElement(\"div\",null);}});}},{key:\"readURL\",value:function readURL(input){var _this7=this;if(input.files&&input.files[0]){var myValue=input.files[0];console.log('antes de cargar');console.log(myValue);if(myValue.type.includes(\"image\")){var reader=new FileReader();var miImagen={name:myValue.name,type:myValue.type};reader.onload=function(event){console.log(\"imagen ya lista para cargar exitosamente\");console.log(event.target.result);$('#blah').attr('src',event.target.result);};reader.readAsDataURL(myValue);// convert to base64 string, al finalizar llama a onloadend\nreader.onloadend=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return reader.result;case 2:miImagen.data=_context.sent;_this7.state.image=miImagen;console.log(\"imagen pasada a base 64\");console.log(_this7.state.image.data);case 6:case\"end\":return _context.stop();}}},_callee);}));}else{Swal.fire({position:'top',icon:'error',title:'SÃ³lo archivos de tipo imagen!',showConfirmButton:false,timer:2000});}}}},{key:\"cargarImagen\",value:function cargarImagen(imagenDeBBDD){if(imagenDeBBDD.type.includes(\"image\")){//CONSEGUIR IMAGEN\nconsole.log(\"imagen traida de bbdd\");console.log(imagenDeBBDD);//EN LA BBDD GUARDO COD BASE 64 pero me devuelve un buffered array :(\n//const blob = new Blob([imagenDeBBDD.data.data], { type: \"image/jpeg\" });\n//console.log(\"imagen en formato blob\");\n//console.log(blob);\n//CARGAR IMAGEN\nvar imagenListaParaLeer=\"\";//$('#blah').attr('src', imagenListaParaLeer);\n}else{Swal.fire({position:'top',icon:'error',title:'SÃ³lo archivos de tipo imagen!',showConfirmButton:false,timer:2000});}}},{key:\"validateFields\",value:function validateFields(){var emptyFields=\"\";var count=0;var nombre=this.state.name;if(nombre.replace(/\\s/g,\"\").length==0){emptyFields+=\" Nombre \";count++;}if(this.state.departmentId==null){emptyFields+=\" Departamento \";count++;}if(this.state.roleId==null){emptyFields+=\" Rol \";count++;}//If there are errors\nif(count>0){Swal.fire({position:'center',icon:'error',title:(count==1?\"Falta el campo\":\"Faltan los campos: \")+emptyFields,showConfirmButton:false,timer:2000});return false;}else{return true;}}},{key:\"updateProfessional\",value:function updateProfessional(){if(this.validateFields()==false){return;}// parametros de datos post\nvar datapost={id:this.state.id,name:this.state.name,departmentId:this.state.departmentId,roleId:this.state.roleId,email:this.state.email,tutorId:this.state.tutorId,comment:this.state.comment,image:this.state.image,imageId:this.state.imageId};console.log(\"imagen introducida en bbdd\");console.log(datapost.image);console.log(JSON.stringify(datapost));ProfessionalService.update(datapost).then(function(res){if(res.data.success){//alert(res.data.message);\nSwal.fire({position:'top',icon:'success',title:'Profesional actualizado correctamente!',showConfirmButton:false,timer:2000});//this.props.history.push('/list'); \n}else{alert(\"Error\");}}).catch(function(error){alert(\"Error 34 \"+error);});}}]);return profileComponent;}(React.Component);export default profileComponent;","map":{"version":3,"sources":["/Users/trabajo/Desktop/ELRINCON/react-rincon/src/modules/editProfile.js"],"names":["React","ProfessionalService","DepartmentService","TutorService","RoleService","ImageService","Swal","$","profileComponent","props","state","departments","roles","tutors","id","name","departmentId","roleId","email","sessionStorage","getItem","tutorId","comment","image","imageId","queryProfessionals","queryDepartments","queryRoles","queryTutors","getWithEmail","then","res","data","success","setState","get","cargarImagen","catch","err","console","log","getAll","value","target","loadDepartments","loadRoles","loadTutors","updateProfessional","require","profilePicture","myProfilePicture","marginTop","width","myElement","myFileElement","readURL","map","input","files","myValue","type","includes","reader","FileReader","miImagen","onload","event","result","attr","readAsDataURL","onloadend","fire","position","icon","title","showConfirmButton","timer","imagenDeBBDD","imagenListaParaLeer","emptyFields","count","nombre","replace","length","validateFields","datapost","JSON","stringify","update","alert","error","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport '../../node_modules/bootstrap/dist/css/bootstrap.min.css';\nimport '../../node_modules/bootstrap/dist/js/bootstrap.bundle.min';\n\nimport ProfessionalService from '../services/professional.service';\nimport DepartmentService from '../services/department.service';\nimport TutorService from '../services/tutor.service';\nimport RoleService from '../services/role.service';\nimport ImageService from '../services/image.service';\nimport Swal from 'sweetalert2';\nimport $ from 'jquery';\n\n\nclass profileComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            departments: [],\n            roles: [],\n            tutors: [],\n            id: null,\n            name: null,\n            departmentId: null,\n            roleId: null,\n            email: sessionStorage.getItem(\"userEmail\"),\n            tutorId: null,\n            comment: \"\",\n            image: null,\n            imageId: null\n        };\n    }\n\n    componentDidMount() {\n        //Professional info\n        this.queryProfessionals();\n        //Dropdowns\n        this.queryDepartments();\n        this.queryRoles();\n        this.queryTutors();\n    }\n\n    queryProfessionals() {\n        ProfessionalService.getWithEmail({ email: this.state.email })\n            .then(res => {\n                if (res.data.success) {\n                    const { id, name, departmentId, roleId, tutorId, comment, imageId } = res.data.data[0];\n\n                    this.setState({\n                        id: id,\n                        name: name,\n                        departmentId: departmentId,\n                        roleId: roleId,\n                        tutorId: tutorId,\n                        comment: comment,\n                        imageId: imageId\n                    });\n\n                    if (imageId != null) {\n                        ImageService.get(imageId).then(res => {\n                            this.setState({ image: res.data.data[0] });\n                            //console.log(\"MI IMAGEN \"+JSON.stringify(this.state.image));\n                            this.cargarImagen(this.state.image);\n\n                        }).catch(err => {\n                            console.log('ERROR server ' + err);\n                        });\n                    } else {\n                        console.log('No hay imagen asociada a esta cuenta.');\n\n                    }\n                    //this.setState(id,name,departmentId,roleId,tutorId,comment,imageId);\n                } else {\n                    console.log('Error quering professional EDIT');\n                }\n            })\n            .catch(err => {\n                console.log('ERROR server' + err);\n            });\n    }\n\n    queryDepartments() {\n        DepartmentService.getAll()\n            .then(res => {\n\n                if (res.data.success) {\n                    const data = res.data.data;\n                    this.setState({ departments: data });\n                } else {\n                    console.log('Error quering departments EDIT');\n                }\n            })\n            .catch(err => {\n                console.log('ERROR server' + err);\n            });\n    }\n\n    queryRoles() {\n        RoleService.getAll()\n            .then(res => {\n\n                if (res.data.success) {\n                    const data = res.data.data;\n                    this.setState({ roles: data });\n                } else {\n                    console.log('Error quering roles EDIT');\n                }\n            })\n            .catch(err => {\n                console.log('ERROR server' + err);\n            });\n    }\n\n    queryTutors() {\n        TutorService.getAll()\n            .then(res => {\n\n                if (res.data.success) {\n                    const data = res.data.data;\n                    this.setState({ tutors: data });\n                } else {\n                    console.log('Error quering tutors EDIT');\n                }\n            })\n            .catch(err => {\n                console.log('ERROR server' + err);\n            });\n    }\n\n    render() {\n        return (\n            <div class=\"container p-4\">\n                <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n                <div class=\"row\">\n                    <div class=\"col-lg-9\">\n                        <div class=\"card\">\n                            <div class=\"card-body\">\n                                <div class=\"form-group \">\n                                    <input type=\"text\"\n                                        value={this.state.name}\n                                        onChange={(value) => this.setState({ name: value.target.value })}\n                                        class=\"form-control\" name=\"nombre\" placeholder=\"Nombre\" autofocus\n                                    />\n                                </div>\n\n                                <div class=\"row\">\n                                    <div class=\"col-lg-3\">\n                                        <div class=\"form-group\">\n                                            <select class=\"form-control\"\n                                                value={this.state.departmentId}\n                                                onChange={(value) => this.setState({ departmentId: value.target.value })} >\n                                                <option selected disabled>Departamento</option>\n                                                {this.loadDepartments()}\n\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                    <div class=\"col-lg-2\">\n                                        <div class=\"form-group\">\n                                            <select class=\"form-control\"\n                                                value={this.state.roleId}\n                                                onChange={(value) => this.setState({ roleId: value.target.value })} >\n                                                <option selected disabled >Rol</option>\n                                                {this.loadRoles()}\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                    <div class=\"col-lg-3\">\n                                        <div class=\"form-group\">\n                                            <select class=\"form-control\"\n                                                value={this.state.tutorId}\n                                                onChange={(value) => this.setState({ tutorId: value.target.value })} >\n                                                <option selected disabled >TutorÃ­a</option>\n                                                {this.loadTutors()}\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                </div>\n\n                                <div class=\"form-group\">\n                                    <textarea class=\"form-control\"\n                                        value={this.state.comment}\n                                        onChange={(value) => this.setState({ comment: value.target.value })}\n                                        placeholder=\"Introduzca si lo desea algÃºn comentario: Me gusta J\"\n                                        rows=\"3\"></textarea>\n                                </div>\n\n                                <div class=\"form-group\">\n                                    <button type=\"submit\" class=\"btn btn-success\" onClick={() => this.updateProfessional()}>Actualizar</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"col-lg-3\">\n                        <div class=\"card\">\n                            <div class=\"card-body text-center\">\n                                <form class=\"md-form\">\n                                    <div class=\"file-field\">\n                                        <div class=\"md-4\" >\n                                            <img src={require(\"../images/profile-picture.jpg\")}\n                                                ref={profilePicture => this.myProfilePicture = profilePicture}\n                                                id=\"blah\"\n                                                class=\"rounded-circle z-depth-1-half avatar-pic img-fluid img-thumbnail\" alt=\"avatar\"\n                                            />\n\n                                            <div style={{ marginTop: \"10px\" }} class=\"d-flex\" >\n                                                <div class=\"btn btn-mdb-color btn-rounded float-left custom-file\">\n                                                    <input style={{ width: \"100%\" }} ref={(myElement) => this.myFileElement = myElement}\n                                                        type=\"file\"\n                                                        id=\"imgInput\"\n                                                        className=\"custom-file-input btn btn-primary\"\n                                                        onChange={(value) => { this.readURL(value.target) }}\n                                                    />\n                                                    <label class=\"custom-file-label\" for=\"customFile\">Perfil</label>\n                                                </div>\n                                            </div>\n                                        </div>\n\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        );\n    }\n\n    loadDepartments() {\n        return this.state.departments.map(data => {\n            if (data) {\n                return (\n                    <option value={data.id}>{data.name}</option>\n                );\n            } else {\n                return <div></div>;\n            }\n        });\n    }\n\n    loadRoles() {\n        return this.state.roles.map(data => {\n            if (data) {\n                return (\n                    <option value={data.id}>{data.name}</option>\n                );\n            } else {\n                return <div></div>;\n            }\n        });\n    }\n\n    loadTutors() {\n        return this.state.tutors.map(data => {\n            if (data) {\n                return (\n                    <option value={data.id}>{data.name}</option>\n                );\n            } else {\n                return <div></div>;\n            }\n        });\n    }\n\n    readURL(input) {\n        if (input.files && input.files[0]) {\n            const myValue = input.files[0];\n\n            console.log('antes de cargar');\n            console.log(myValue);\n\n            if (myValue.type.includes(\"image\")) {\n                const reader = new FileReader();\n                let miImagen = {\n                    name: myValue.name,\n                    type: myValue.type\n                }\n\n                reader.onload = (event) => {\n                    console.log(\"imagen ya lista para cargar exitosamente\");\n                    console.log(event.target.result);\n                    $('#blah').attr('src', event.target.result);\n                }\n                reader.readAsDataURL(myValue); // convert to base64 string, al finalizar llama a onloadend\n                reader.onloadend = async () => {\n                    //IMAGEN EN BASE 64 = reader.result\n                    miImagen.data = await reader.result;\n                    this.state.image = miImagen;\n                    console.log(\"imagen pasada a base 64\");\n                    console.log(this.state.image.data);\n                }\n            } else {\n                Swal.fire({\n                    position: 'top',\n                    icon: 'error',\n                    title: 'SÃ³lo archivos de tipo imagen!',\n                    showConfirmButton: false,\n                    timer: 2000\n                })\n            }\n        }\n    }\n\n    cargarImagen(imagenDeBBDD) {\n        if (imagenDeBBDD.type.includes(\"image\")) {\n            //CONSEGUIR IMAGEN\n            console.log(\"imagen traida de bbdd\");\n            console.log(imagenDeBBDD);\n            \n            //EN LA BBDD GUARDO COD BASE 64 pero me devuelve un buffered array :(\n            \n            //const blob = new Blob([imagenDeBBDD.data.data], { type: \"image/jpeg\" });\n            //console.log(\"imagen en formato blob\");\n            //console.log(blob);\n\n            //CARGAR IMAGEN\n            const imagenListaParaLeer = \"\";\n            //$('#blah').attr('src', imagenListaParaLeer);\n        } else {\n            Swal.fire({\n                position: 'top',\n                icon: 'error',\n                title: 'SÃ³lo archivos de tipo imagen!',\n                showConfirmButton: false,\n                timer: 2000\n            })\n        }\n    }\n\n    validateFields() {\n        let emptyFields = \"\";\n        let count = 0;\n        const nombre = this.state.name;\n\n        if (nombre.replace(/\\s/g, \"\").length == 0) {\n            emptyFields += \" Nombre \";\n            count++;\n        }\n        if (this.state.departmentId == null) {\n            emptyFields += \" Departamento \";\n            count++;\n        }\n        if (this.state.roleId == null) {\n            emptyFields += \" Rol \";\n            count++;\n        }\n\n        //If there are errors\n        if (count > 0) {\n            Swal.fire({\n                position: 'center',\n                icon: 'error',\n                title: (count == 1 ? \"Falta el campo\" : \"Faltan los campos: \") + emptyFields,\n                showConfirmButton: false,\n                timer: 2000\n            })\n            return false;\n        } else {\n            return true;\n        }\n\n    }\n\n    updateProfessional() {\n        if (this.validateFields() == false) {\n            return;\n        }\n\n        // parametros de datos post\n        const datapost = {\n            id: this.state.id,\n            name: this.state.name,\n            departmentId: this.state.departmentId,\n            roleId: this.state.roleId,\n            email: this.state.email,\n            tutorId: this.state.tutorId,\n            comment: this.state.comment,\n            image: this.state.image,\n            imageId: this.state.imageId\n        }\n        console.log(\"imagen introducida en bbdd\");\n        console.log(datapost.image);\n        console.log(JSON.stringify(datapost));\n\n        ProfessionalService.update(datapost)\n            .then(res => {\n                if (res.data.success) {\n                    //alert(res.data.message);\n                    Swal.fire({\n                        position: 'top',\n                        icon: 'success',\n                        title: 'Profesional actualizado correctamente!',\n                        showConfirmButton: false,\n                        timer: 2000\n                    })\n                    //this.props.history.push('/list'); \n                }\n                else {\n                    alert(\"Error\");\n                }\n            }).catch(error => {\n                alert(\"Error 34 \" + error);\n            });\n    }\n}\n\n\n\nexport default profileComponent;"]},"metadata":{},"sourceType":"module"}